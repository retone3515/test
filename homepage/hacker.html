<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacking</title>
    <style>
        /* スクロールをなめらかにする */
        html {
            scroll-behavior: smooth;
        }

        /* スクロールバー全体 */
        ::-webkit-scrollbar {
            width: 10px;
        }

        /* スクロールバー背景 */
        ::-webkit-scrollbar-track {
            background: #000000;
            box-shadow: inset 0 0 2px #777;
        }

        /* スクロールバーつまみ */
        ::-webkit-scrollbar-thumb {
            background: #19fc19;
        }

        body {
            background-color: black;
            overflow-x: hidden;
        }

        .div_txt {
            font-family: "sazanami";
            caret-color: #ffffff;
            color: #19fc19;
            background-color: black;
            border: none;
            outline: none;
            font-size: 30px;
            white-space: nowrap;
        }

        .input_txt {
            font-family: "sazanami";
            caret-color: #ffffff;
            color: #00ff00;
            background-color: black;
            border: none;
            outline: none;
            width: 90%;
            font-size: 30px;
            white-space: nowrap;
        }
    </style>
    <script src="./js/msg.js"></script>
    <script>
        // キー入力イベント定義
        document.addEventListener("keypress", keypress_event);
        // 表示用カウンタ
        let gARR_CNT = 0;
        let gCHAR_CNT = 0;
        // 表示用配列
        let gTARGET_ARR = [];

        // 処理中フラグ
        let isTransaction = false;

        // コマンドフラグ
        let isCmd = false;

        let gINPUT_ID = "001";
        // 0:パス入力、1:パスワード照合、2:ログイン完了
        let gINIT_FLG = 0;

        let gUSER_NAME = "";

        // 初期表示文字
        let gINIT_MSG_ARR = [
            "　　　★★★★★　　★★　　★★★★★★　　　",
            "　　★★　　　★　　★★　　★　　　　★★　　",
            "　★★　　　　　　　★★　　★　　　　　★★　",
            "　★　　　　　　　　★★　　★　　　　　　★　",
            "　★　　　　　　　　★★　　★　　　　　　★　",
            "　★　　　　　　　　★★　　★　　　　　　★　",
            "　★★　　　　　　　★★　　★　　　　　★★　",
            "　　★★　　　★　　★★　　★　　　　★★　　",
            "　　　★★★★　　　★　　　★★★★★★　　　",
            "Welcome to Hack experience...",
            "Please input USER name and PASSWORD.",
            "USER:"
        ];


        /*
         * キーボード入力受付
         */
        function keypress_event(e) {
            if (e.keyCode == 13) {
                execCode();

                return;
            }

            return false;
        }

        /*
         * 初期化処理
         *
         */
        function init() {
            // 適当に文字を流す
            gTARGET_ARR = gINIT_MSG_ARR;
            showMessage(true);
        }

        // メッセージ表示（true:文字単位、false:行単位）
        function showMessage(aFlg) {
            isTransaction = true;
            isCmd = true;
            let time = 5;
            // 文字単位表示
            if (aFlg == true) {
                document.getElementById(gINPUT_ID).value += gTARGET_ARR[gARR_CNT].charAt(gCHAR_CNT);
                gCHAR_CNT++;

                if (gTARGET_ARR[gARR_CNT].length < gCHAR_CNT) {
                    gARR_CNT++;
                    gCHAR_CNT = 0;
                    nextInput("text");
                }

                // 行単位表示
            } else {
                time = 50;
                document.getElementById(gINPUT_ID).value += gTARGET_ARR[gARR_CNT];
                gARR_CNT++;
                nextInput("text");
            }

            if (gTARGET_ARR.length > gARR_CNT) {
                setTimeout(function () { showMessage(aFlg) }, time);
            } else {
                gARR_CNT = 0;
                gCHAR_CNT = 0;
                isTransaction = false;
                isCmd = false;
            }
        }

        // 次の行へ
        function nextInput(aType) {
            // 前の行は入力できなくする
            document.getElementById(gINPUT_ID).readOnly = true;

            let inputId = parseInt(gINPUT_ID);
            gINPUT_ID = "00" + ++inputId;
            gINPUT_ID = gINPUT_ID.slice(-3);

            // ユーザ名
            let div = null;
            if (gINIT_FLG >= 1 && isCmd == false) {
                div = document.createElement("div");
                div.className = "div_txt";
                div.innerHTML = gUSER_NAME + "@cid>";
            }

            // 入力エリア
            let inTxt = document.createElement("input");
            inTxt.type = aType;
            inTxt.className = "input_txt";
            inTxt.id = gINPUT_ID;
            inTxt.maxlength = 100;
            if (div != null) {
                div.appendChild(inTxt);
                document.getElementById("cmd").appendChild(div);
            } else {
                document.getElementById("cmd").appendChild(inTxt);
            }

            setTimeout(setFocus, 100);
        }

        function setFocus() {
            document.getElementById(gINPUT_ID).focus();
        }

        function execCode() {
            if (isTransaction == true) {
                return;
            }

            // 初期イベント中
            if (gINIT_FLG == 0) {
                if (document.getElementById(gINPUT_ID).value == "") {
                    nextInput("text");
                    setMessage("Please input USER!");
                    nextInput("text");
                    setMessage("USER:");
                    nextInput("text");
                    return;
                }

                gUSER_NAME = document.getElementById(gINPUT_ID).value;

                nextInput("text");
                setMessage("PASS:");
                nextInput("password");
                gINIT_FLG++;

                return;
            } else if (gINIT_FLG == 1) {
                // 特にパスワードをチェックしない
                nextInput("text");
                gINIT_FLG++;
                return;
            }

            isCmd = true;
            // コマンド処理
            switch (document.getElementById(gINPUT_ID).value) {
                case "hack":
                    gTARGET_ARR = HACK_MSG;
                    showMessage(true);
                    break;

                case "mat":
                    nextInput("text");
                    let ramNumArr = [];
                    for (let i = 0; i < 200; i++) {
                        let ran = "";
                        for (let j = 0; j < 100; j++) {
                            ran += Math.floor(Math.random() * 2);
                        }
                        ramNumArr.push(ran);
                    }

                    gTARGET_ARR = ramNumArr;
                    showMessage(false);
                    break;

                case "ls2":
                    nextInput("text");
                    gTARGET_ARR = ["dir score/","dir log/","dir time/"];
                    showMessage(false);
                    break;

                case "rm score.txt":
                case "rm *":
                    break;



                default:
                    if (document.getElementById(gINPUT_ID).value != "") {
                        nextInput("text");
                        setMessage("command not found");
                    }
            }
            isCmd = false;
            nextInput("text");
        }

        function setMessage(aValue) {
            document.getElementById(gINPUT_ID).value = aValue;
        }
    </script>
</head>

<body onload="init()">
    <div id="cmd">
        <input id="001" class="input_txt" type="text">
    </div>
</body>

</html>